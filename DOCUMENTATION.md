# Bread x Shopify Integration

# Bread App

#### Installation
The Bread x Shopify app is a privately distributed app. To install it, please go to the url below - substitute {{nativeShopifyShopName}} with the name Shopify assigned to your Shop.


https://shopify.getbread.com/install?shop={{nativeShopifyShopName}}


#### Settings
When you click on the Bread app inside of the Apps section of your Shop's admin site, you'll be taken to the settings page. Here you will be provided with a number of customizable options:

- Production
	- When checked, the app will make checkouts against Bread's production servers. When toggling this input, make sure to update the api key and shared secret options accordingly
- ApiKey
	- Input the api key provided to you by Bread. Ensure that the api key corresponds to the correct environment (production or sandbox).
- Shared Secret
	- Input the shared secret provided to you by Bread. Ensure the shared secret corresponds to the correct environment (production or sandbox).
- Custom CSS
	- Provide the custom css you would like to use to style the Bread button on your site.
- Auto Settle Payments
	- When checked, orders made through the Bread buttons will be automatically settled
- Save New Customers
	- When checked, customers who make orders through the Bread buttons will be automatically saved into your Shop's backend
- Product DIV acts as label
	- When checked and if the customer is already logged into Bread, the Bread button on a product detail page will act as a button displaying "price / month" for the product variant
- Manual integration
	- When checked, Bread scripts will not be automatically loaded through the Bread x Shopify app, and the merchant will be responsible for completing a manual integration. This can be done to improve load times for the button. Look over the manual integration section below for details.

#### Set Up
To add the Bread button to your store front, you will need to place these HTML divs into your Shop's cart & product-detail liquid templates. Placement is up to you, but please ensure that the div's id attributes match the examples below.



```html
// cart div
<div id="bread-checkout-btn">
</div>

// product detail div
<div id="bread-checkout-btn-product">
</div>

```

### Order Confirmation Page
When orders are completed through the Bread Button, we redirect customers to an Order Confirmation/Summary page which is rendered by a liquid template served through our app.

To position and, if needed, style the container for this confirmation page, we have attached some css classes to the markup. Below are a few of the classes available, which can be defined in your shop's theme files.

* `bread-success-container`
* `bread-success-header`
* `bread-success-order-info-container`
* `bread-success-table`
* `bread-success-table-row`
* `bread-success-address-container`
* `bread-success-sub-header`
* `bread-success-paragraph`
* `bread-success-itemization-container`

You can explore the DOM for the confirmation page by completing a check out and inspecting the confirmation page's markup through the browser. If you find a class that is prefixed by `bread-success`, it is free for you to add style definitions.

### Manual Integration
The Bread x Shopify plugin embeds custom javascript on your store front to manage the Bread buttons using the Shopify scripttag API: [https://help.shopify.com/api/reference/scripttag](https://help.shopify.com/api/reference/scripttag).

If you would like to improve load time or customize your integration by overriding the default button behavior, you can take these steps to manually load Bread x Shopify scripts onto your store front:

1. Get your BreadShopID from the Bread Shopify App settings page
2. Ensure that the option to manually embed the javascript files is selected and saved
3. Generate the JS url by inserting your BreadShopID into this url: `https://shopify.getbread.com/static/{{BreadShopID}}/cart.js`
4. Insert a script node using the url you generated in step #3 into your top level liquid template (often called `theme.liquid`)
5. You are now manually loading our custom Bread X Shopify javascript onto your store front, the integration should work regularly

### Overriding Default Button Options
To override options we generate for the two buttons/divs the plugin manages, you can provide a callback of your own that will have the opportunity to override/update the default options generated by our plugin. As a reminder the ids for the buttons the plugin manages are: `bread-checkout-btn` & `bread-checkout-btn-product`.

To do this, it is recommended that you manually integrate the Bread x Shopify javascript files to avoid timing issues during page load - the instructions to do this are outlined in the Manual Integration section.

The Bread x Shopify javascript exposes a public api through the `BreadShopify` window object. To set the callback which will override the default options, use the function `window.BreadShopify.setWillCheckoutWithOpts` like this:

```javascript
window.BreadShopify.setWillCheckoutWithOpts(function (defaultOpts, cb) {
	// Ensure these are the options 
	// for the button you are looking 
	// to customize
	if (defaults.buttonId !== "bread-checkout-btn-product") {
		cb(null, defaultOpts);
	}

	// Update the default opts object 
	// with your custom settings
	defaultOpts.customCSS = "/* Custom CSS Definitions */"
	cb(null, defaultOpts);
	
	// Or you can short circuit the button 
	// by passing back an error
	cb(err);
});
```

Your provided override function will get called every time we set the options for a button - this includes every time a customer chooses a new variant on a product detail page.

As a reminder, it's important that your code which sets the override function is run after the Bread X Shopify javascript is loaded onto the page - otherwise the `window.BreadShopify` object will not be available.

For more information on the structure of the opts object look at the developer document here: [http://developers.getbread.com](http://developers.getbread.com)

### Inspecting Button Options

As another convenience method, you can pull a copy of the checkout options currently being used by a button by using this function:

```javascript
var productButtonOpts = window.BreadShopify
	.optsForButtonId("bread-checkout-btn-product);
```

As an example, you can then use that copy of the button options to add another button inside an additional div you've provided:

```javascript
productButtonOpts.buttonId = "additionalDivId"
bread.checkout(productButtonOpts);
```

### Best practices
As the button is being loaded onto your Shop's store front, it is recommended that you provide a fallback element that will be shown as the button is being rendered. To do this, decide on the appropriate styling of the fallback element, and add the styling and text to the button div directly. Below you will see a div similar to the one shown above, with CSS and text modifications to act as a fallback element.

```html
// product detail div with fallback element
<div id="bread-checkout-btn-product"
	 style="background-color: #000000; color: #FFFFFF;
	 	     width: 250px; height: 50px;">
	Pay Over Time
</div>

```

#### Usage

You're all set. Orders created through the Bread button will show up in your Shop's admin portal, and actions taken on orders (Cancel, Refund, Capture) will be reflected in Bread's systems. Please reach out to your Bread representative or support@getbread.com should you experience any difficulties with the Bread x Shopify integration.

# Bread Payment Gateway

#### Installation
The Bread x Shopify payment gateway is a privately distributed Shopify gateway. To install it, please go to the the url below. Shopify will ask you for your Shop's login credentials, and you will then be asked to add the gateway to your shop. Once accepted, the Bread payment gateway will show up as an option in the "Alternative Payments" section in the payment settings section of your Shop's admin portal. Once you have installed the gateway,  on the same page you will see a toggle button to switch between test & production modes.

[https://www.shopify.com/login?redirect=authorize_gateway%2F1020110](https://www.shopify.com/login?redirect=authorize_gateway%2F1020110)

Before completing the setup, you will need to create a Bread x Shopify gateway account to retrieve your gateway credentials. To create this account, follow the link below.

[https://shopify.getbread.com/gateway](https://shopify.getbread.com/gateway)

Input your preferred email/password combination to create an account, and be sure to keep these stored for later reference. Once logged in, you will be looking at the Bread x Shopify payments gateway portal. This page contains three sections, their purposes are outlined below:

1. Gateway Credentials
	- These keys are used to activate the payment gateway in your Shop's payments settings page
	- By clicking refresh, your gateway credentials will be recreated, and you will have to subsequently update your payment gateway settings in your Shop's admin portal
2. Bread Settings
	- This is where you connect your Bread x Shopify payment gateway account to Bread's main systems. Input the keys provided to you by Bread, for each of the respective environments. This section also contains a checkbox to automatically settle payments coming from the gateway, the default is false.
3. Account Settings
	- You can update your Bread x Shopify gateway account password here.

Now go back to the payments settings page in your Shop's admin portal. Set up the Bread payment gateway (under Alternative Payments), and insert the Bread payment gateway credentials provided to you in the last step. (If you would like to perform test transactions through the gateway, simply check the "Use test mode" checkbox. Your test transactions will be available in [https://merchants-sandbox.getbread.com](https://merchants-sandbox.getbread.com).)

The Bread x Shopify payment gateway will now be available to your customers at checkout. To settle, cancel, or refund orders you will need to do so through the Bread merchant portal ([https://merchants.getbread.com](https://merchants.getbread.com) or [https://merchants-sandbox.getbread.com](https://merchants-sandbox.getbread.com)). Actions taken in the Shopify order management system will not be reflected on the Bread backends.

# Support

Should you need any assistance or have any questions please reach out to us at support@getbread.com.
